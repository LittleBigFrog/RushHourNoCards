<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rush Hour Puzzle Viewer</title>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        // RushHourBoard component remains exactly the same as your original
        const RushHourBoard = ({ boardString = "IBBxooIooLDDJAALooJoKEEMFFKooMGGHHHM" }) => {
            // All your original RushHourBoard code here...
            // [Previous RushHourBoard component code remains unchanged]
        };

        // New RangeSlider component
        const RangeSlider = ({ value, min, max, onChange, label }) => (
            <div className="mb-4">
                <label className="block text-sm font-medium text-gray-700 mb-1">
                    {label}: {value}
                </label>
                <input
                    type="range"
                    min={min}
                    max={max}
                    value={value}
                    onChange={(e) => onChange(parseInt(e.target.value))}
                    className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                />
                <div className="flex justify-between text-xs text-gray-500">
                    <span>{min}</span>
                    <span>{max}</span>
                </div>
            </div>
        );

        // Database component
        const App = () => {
            const [currentPuzzle, setCurrentPuzzle] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [movesRange, setMovesRange] = React.useState({ min: 0, max: 100, current: 50 });
            const [statesRange, setStatesRange] = React.useState({ min: 0, max: 10000, current: 5000 });
            const [allPuzzles, setAllPuzzles] = React.useState([]);

            // Function to load the database file
            const loadDatabase = async () => {
                try {
                    const response = await fetch('rush_no_walls.txt');
                    const text = await response.text();
                    const lines = text.trim().split('\n');
                    
                    const puzzles = lines.map(line => {
                        const [moves, board, states] = line.trim().split(' ');
                        return {
                            moves: parseInt(moves),
                            board,
                            states: parseInt(states)
                        };
                    });

                    // Calculate actual ranges from data
                    const moves = puzzles.map(p => p.moves);
                    const states = puzzles.map(p => p.states);
                    
                    setMovesRange(prev => ({
                        min: Math.min(...moves),
                        max: Math.max(...moves),
                        current: Math.min(prev.current, Math.max(...moves))
                    }));
                    
                    setStatesRange(prev => ({
                        min: Math.min(...states),
                        max: Math.max(...states),
                        current: Math.min(prev.current, Math.max(...states))
                    }));

                    return puzzles;
                } catch (error) {
                    console.error('Error loading database:', error);
                    return [];
                }
            };

            // Function to select a random puzzle based on filters
            const selectRandomPuzzle = () => {
                const filteredPuzzles = allPuzzles.filter(puzzle => 
                    puzzle.moves <= movesRange.current &&
                    puzzle.states <= statesRange.current
                );

                if (filteredPuzzles.length > 0) {
                    const randomPuzzle = filteredPuzzles[Math.floor(Math.random() * filteredPuzzles.length)];
                    setCurrentPuzzle(randomPuzzle);
                }
            };

            // Load initial data
            React.useEffect(() => {
                const initialize = async () => {
                    const puzzles = await loadDatabase();
                    setAllPuzzles(puzzles);
                    if (puzzles.length > 0) {
                        setCurrentPuzzle(puzzles[Math.floor(Math.random() * puzzles.length)]);
                    }
                    setLoading(false);
                };
                initialize();
            }, []);

            if (loading) {
                return (
                    <div className="flex justify-center items-center min-h-screen">
                        <div className="text-xl">Loading...</div>
                    </div>
                );
            }

            return (
                <div className="container mx-auto px-4 py-8">
                    <h1 className="text-3xl font-bold text-center mb-8">Rush Hour Puzzle Viewer</h1>
                    
                    {currentPuzzle && (
                        <div className="max-w-xl mx-auto">
                            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <RushHourBoard boardString={currentPuzzle.board} />
                                <div className="mt-4 text-center text-gray-700">
                                    <p>Moves required: {currentPuzzle.moves}</p>
                                    <p>Reachable states: {currentPuzzle.states}</p>
                                </div>
                            </div>
                            
                            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <RangeSlider
                                    value={movesRange.current}
                                    min={movesRange.min}
                                    max={movesRange.max}
                                    onChange={(value) => setMovesRange(prev => ({ ...prev, current: value }))}
                                    label="Maximum Moves Required"
                                />
                                <RangeSlider
                                    value={statesRange.current}
                                    min={statesRange.min}
                                    max={statesRange.max}
                                    onChange={(value) => setStatesRange(prev => ({ ...prev, current: value }))}
                                    label="Maximum Reachable States"
                                />
                            </div>
                            
                            <div className="text-center">
                                <button 
                                    onClick={selectRandomPuzzle}
                                    className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                                >
                                    New Random Puzzle
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
